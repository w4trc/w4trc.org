---
// Lightweight wrapper for weatherwidget.io that re-initializes on client navigation.
const scriptId = "weatherwidget-io-js";
---

<div class="weather-widget">
  <a
    class="weatherwidget-io"
    href="https://forecast7.com/en/36d55n82d56/kingsport/?unit=us"
    data-label_1="KINGSPORT"
    data-label_2="WEATHER"
    data-theme="pure"
  >
    KINGSPORT WEATHER
  </a>
</div>

<script is:inline>
  (() => {
    const scriptId = "weatherwidget-io-js";
    const init = () => window.__weatherwidget_init && window.__weatherwidget_init();
    const load = () => {
      const existing = document.getElementById(scriptId);
      if (existing) {
        init();
        return;
      }
      const js = document.createElement("script");
      js.id = scriptId;
      js.src = "https://weatherwidget.io/js/widget.min.js";
      js.onload = init;
      document.body.appendChild(js);
    };
    const run = () => {
      if (document.readyState === "complete" || document.readyState === "interactive") {
        load();
      } else {
        document.addEventListener("DOMContentLoaded", load, { once: true });
      }
    };
    run();
    window.addEventListener("astro:page-load", run);
    window.addEventListener("astro:after-swap", run);
  })();
</script>
