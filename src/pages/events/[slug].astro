---
import { getCollection, getEntry } from "astro:content";
import Base from "@/layouts/Base.astro";

export const prerender = true;

export async function getStaticPaths() {
  const events = await getCollection("events");
  return events.map((e) => ({ params: { slug: e.slug } }));
}

const { slug } = Astro.params;
const event = await getEntry("events", slug);
if (!event) throw new Error(`Event not found: ${slug}`);

const { data } = event;
const { Content } = await event.render();

const fmtDate = (iso) =>
  new Date(iso).toLocaleDateString(undefined, {
    weekday: "short",
    year: "numeric",
    month: "short",
    day: "numeric",
  });
const fmtTime = (iso) =>
  new Date(iso).toLocaleTimeString(undefined, { hour: "numeric", minute: "2-digit" });

const dateLine = data.endDate
  ? `${fmtDate(data.date)} • ${fmtTime(data.date)}–${fmtTime(data.endDate)}`
  : `${fmtDate(data.date)} • ${fmtTime(data.date)}`;
---

<Base
  title={data.title}
  meta_title={`KARC - ${data.title}`}
  description={data.summary}
  image={data.cover}
>
  <!-- Breadcrumb -->
<nav class="py-4">
  <div class="max-w-[1100px] mx-auto px-6 text-sm">
    <a href="/events/" class="text-gray-300 hover:text-white underline underline-offset-4">
      &larr; Back to Events
    </a>
  </div>
</nav>

<!-- Single outer section to avoid alternating backgrounds -->
<section class="section-md">
  <div class="max-w-[900px] mx-auto px-6 text-center">
    {data.cover && (
      <img
        src={data.cover}
        alt={data.title}
        class="max-w-sm w-full mx-auto rounded-lg shadow mb-6"
        loading="eager"
        decoding="async"
      />
    )}

    <h1 class="text-4xl font-extrabold mb-2">{data.title}</h1>
    {data.summary && (
      <p class="text-lg text-gray-200 mb-8 max-w-2xl mx-auto">{data.summary}</p>
    )}

    <!-- Centered divider -->
    <div class="relative flex justify-center mb-8">
      <span class="inline-block h-1 w-12 bg-[var(--w4-accent)] rounded-full"></span>
    </div>

    <!-- Keep ONLY this details block -->
    <div class="text-left mb-10">
      <h2 class="text-2xl font-bold text-center mb-6 text-white">Event Details</h2>
      <ul class="space-y-3 text-gray-200 text-base leading-relaxed">
        <li>
          <strong class="text-white font-semibold">When:</strong> {dateLine}
        </li>
        {data.location && (
          <li>
            <strong class="text-white font-semibold">Location:</strong> {data.location}
          </li>
        )}
      </ul>
    </div>

    <!-- Markdown Content (no box) -->
    <div class="text-left">
      <div class="prose prose-invert max-w-none event-body">
        <Content />
      </div>
    </div>
  </div>
</section>

<style>
  /* Improve readability */
  .event-body { color: var(--w4-ink); font-size: 1.05rem; line-height: 1.75; }
  .event-body p { color: rgba(255,255,255,.9); }
  .event-body a { color: var(--w4-accent); text-decoration: underline; }

  /* Ensure no card-like panels leak into markdown */
  .event-body :where(.w4-card,.meeting-box,.quicklink-card,.news-card,blockquote,pre,code){
    background: transparent !important; border: 0 !important; box-shadow: none !important;
  }
</style>

</Base>
